/*
 * LoginPanel.java
 *
 * Created on October 29, 2009, 1:37 PM
 */

package osa.ora.server.client.ui;

import java.awt.Dimension;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import osa.ora.server.client.*;

/**
 *
 * @author  ooransa
 */
public class LoginPanel extends javax.swing.JPanel {
    ChatClientApp chatApp;
    /** Creates new form LoginPanel */
    public LoginPanel(ChatClientApp chatApp) {
        this.chatApp=chatApp;
        initComponents();
        jTextField1.setText(chatApp.getClientSettingBean().getUserEmail());
        if("1".equals(chatApp.getClientSettingBean().getRememberPass())){
            jPasswordField1.setText(chatApp.getClientSettingBean().getPassword());
        }
    }
    public void updatePassword(String newPass){
        jPasswordField1.setText(newPass);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;
        
        jLabel1 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        jPasswordField1 = new javax.swing.JPasswordField();
        loginButton = new javax.swing.JButton();
        
        setLayout(new java.awt.GridBagLayout());
        
        jLabel1.setText("User Email:");
        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/email.gif")));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.ipadx = 27;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(30, 20, 0, 0);
        add(jLabel1, gridBagConstraints);
        
        jTextField1.setText("rashab@iti.com");
        jTextField1.setPreferredSize(new Dimension(130,20));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 5;
        gridBagConstraints.ipadx = 109;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(6, 30, 0, 32);
        add(jTextField1, gridBagConstraints);
        
        jLabel2.setText("User Password:");
        jLabel2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/login.gif")));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.ipadx = 35;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(11, 20, 0, 0);
        add(jLabel2, gridBagConstraints);
        
        jPasswordField1.setText("iti");
        jPasswordField1.setPreferredSize(new Dimension(130,20));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.gridwidth = 5;
        gridBagConstraints.ipadx = 109;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(6, 30, 0, 32);
        add(jPasswordField1, gridBagConstraints);
        
        loginButton.setText("Login");
        loginButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.ipadx = 13;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(27, 50, 0, 0);
        add(loginButton, gridBagConstraints);
        jTextField1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                fieldKeyReleased(evt);
            }
        });
        jPasswordField1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                fieldKeyReleased(evt);
            }
        });
    }// </editor-fold>
    private void fieldKeyReleased(java.awt.event.KeyEvent evt) {
        if (evt.getKeyCode() == 10) {
            jButton1ActionPerformed(null);
        }
    }
    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        if(jTextField1.getText()==null || jTextField1.getText().equals("") || jPasswordField1.getText()==null || jPasswordField1.getText().equals("")){
            JOptionPane.showMessageDialog(this,"Please enter user email and password!","Error",JOptionPane.ERROR_MESSAGE,chatApp.getErrorIcon());
        }else{
            try {
                chatApp.login(jTextField1.getText(),jPasswordField1.getText());
                chatApp.showContactList();
            } catch (Exception ex) {
                try {
                    chatApp.initServer();
                    chatApp.login(jTextField1.getText(), jPasswordField1.getText());
                    chatApp.showContactList();
                } catch (Exception ex1) {
                    JOptionPane.showMessageDialog(this,ex1.getMessage(),"Error",JOptionPane.ERROR_MESSAGE,chatApp.getErrorIcon());
                }
            }
        }
    }//GEN-LAST:event_jButton1ActionPerformed
    
    
    private javax.swing.JButton loginButton;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPasswordField jPasswordField1;
    private javax.swing.JTextField jTextField1;
    
}
