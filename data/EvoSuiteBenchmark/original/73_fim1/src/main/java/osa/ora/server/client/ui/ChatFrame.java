/*
 * ChatFrame.java
 *
 * Created on October 29, 2009, 2:48 PM
 */

package osa.ora.server.client.ui;

import java.awt.event.ItemEvent;
import javax.swing.Icon;
import javax.swing.JButton;
import javax.swing.JPanel;
import osa.ora.server.client.*;
import osa.ora.server.client.ui.utils.ClosableTabbedPaneUI;

/**
 *
 * @author  ooransa
 */
public class ChatFrame extends javax.swing.JFrame {
    private int initial_status=0;    
    /** Creates new form ChatFrame */
    ChatClientApp chatApp;
    AboutDialog aboutUI;
    public ChatFrame(ChatClientApp chatApp){
        this.chatApp=chatApp;
        //will changed to accept initalization of initial_status
        initComponents();
        aboutUI=new AboutDialog(this, true);
        aboutUI.setTitle("Free Instant Messenger");
        aboutUI.setResizable(false);
        aboutUI.setSize(230, 205);
        aboutUI.setLocationRelativeTo(copyrightButton);
        aboutUI.setAlwaysOnTop(true);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {
        jLabel1 = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        statsComboBox = new javax.swing.JComboBox();
        settingsButton = new javax.swing.JButton();
        copyrightButton= new JButton();
        jPanel2 = new javax.swing.JPanel();
        JPanel jPanel5 = new javax.swing.JPanel();
        setParentTabbedPane(new javax.swing.JTabbedPane());        
        ClosableTabbedPaneUI myTestPlaf=new ClosableTabbedPaneUI(chatApp);
        getParentTabbedPane().setUI(myTestPlaf);
        contactsPanel = new javax.swing.JPanel();
        
        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        //jLabel1.setIcon(new ImageIcon(Toolkit.getDefaultToolkit().getImage(getClass().getResource("/images/banner1.JPG")).getScaledInstance(jLabel1.getWidth(), jLabel1.getHeight(), Image.SCALE_SMOOTH)));
        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/banner.png")));
        getContentPane().add(jPanel5, java.awt.BorderLayout.NORTH);
        jPanel5.add(jLabel1);
        jPanel1.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));
        jLabel2.setText("Status");
        jPanel1.add(jLabel2);
        
        statsComboBox.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Sign Out"}));
        statsComboBox.setPreferredSize(new java.awt.Dimension(99, 22));
        statsComboBox.setSelectedIndex(initial_status);
        statsComboBox.setEnabled(false);
        jPanel1.add(statsComboBox);
        
        settingsButton.setText("Settings");
        settingsButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                settingsButtonActionPerformed(evt);
            }
        });
        
        jPanel1.add(settingsButton);
        copyrightButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/chat.png")));
        copyrightButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                copyRightButtonActionPerformed(evt);
            }
        });

        jPanel1.add(copyrightButton);
        getContentPane().add(jPanel1, java.awt.BorderLayout.SOUTH);
        
        jPanel2.setLayout(new java.awt.BorderLayout());
        
        getParentTabbedPane().setTabLayoutPolicy(javax.swing.JTabbedPane.SCROLL_TAB_LAYOUT);
        contactsPanel.setLayout(new java.awt.BorderLayout());
        getParentTabbedPane().addTab("Login", new javax.swing.ImageIcon(getClass().getResource("/images/login.gif")), contactsPanel);
        jPanel2.add(getParentTabbedPane(), java.awt.BorderLayout.CENTER);
        
        getContentPane().add(jPanel2, java.awt.BorderLayout.CENTER);
        /*
        this.addMouseMotionListener(new MouseMotionListener() {
            public void mouseDragged(MouseEvent e) {
            }
            public void mouseMoved(MouseEvent e) {
                //System.out.println("mouse over");
                chatApp.number=20;                
            }
        });*/
        pack();
    }
    private void statusChanged(){
        if(initial_status!=statsComboBox.getSelectedIndex()){
            chatApp.updateMyStatus(statsComboBox.getSelectedIndex());
            initial_status=statsComboBox.getSelectedIndex();
        }
    }
    private void settingsButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_settingsButtonActionPerformed
        chatApp.showSettings();
    }//GEN-LAST:event_settingsButtonActionPerformed
    private void copyRightButtonActionPerformed(java.awt.event.ActionEvent evt) {
        aboutUI.setVisible(true);
    }
    public void updateStatusList(String [] statusList,int defaultStatus){
        statsComboBox.setModel(new javax.swing.DefaultComboBoxModel(statusList));
        statsComboBox.setSelectedIndex(defaultStatus);
        initial_status=defaultStatus;
        statsComboBox.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(ItemEvent e) {
                statusChanged();
            }
        });
        statsComboBox.validate();
    }
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new ChatFrame(null).setVisible(true);
            }
        });
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel contactsPanel;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JTabbedPane parentTabbedPane;
    private javax.swing.JButton settingsButton;
    private javax.swing.JComboBox statsComboBox;
    // End of variables declaration//GEN-END:variables
    private JButton copyrightButton;
    public JPanel getContactPanel(){
        return contactsPanel;
    }
    public boolean addNewFrame(String title,Icon icon,ChatWindowPanel newPanel){
        int n=getParentTabbedPane().getTabCount();
        boolean not_exist=true;
        for(int i=0;i<n;i++){
            if(getParentTabbedPane().getTitleAt(i).equals(title)){
                not_exist=false;
                getParentTabbedPane().setSelectedIndex(i);
                return false;
            }
        }
        if(not_exist){
            getParentTabbedPane().addTab(title,icon,newPanel);
            getParentTabbedPane().setSelectedIndex(getParentTabbedPane().getTabCount()-1);
            getParentTabbedPane().validate();
            return true;
        }
        return false;
    }
    public void updateFrameIconForUser(String title,Icon icon){
        int n=getParentTabbedPane().getTabCount();
        for(int i=0;i<n;i++){
            if(getParentTabbedPane().getTitleAt(i).equals(title)){
                getParentTabbedPane().setIconAt(i,icon);
                getParentTabbedPane().repaint();
                getParentTabbedPane().validate();
            }
        }
        return;
    }
    public void setIconAt(int index,Icon icon){
        getParentTabbedPane().setIconAt(index,icon);
    }
    public void setTitleAt(int index, String title){
        getParentTabbedPane().setTitleAt(index,title);
    }
    public void removeFrame(int index){
        getParentTabbedPane().removeTabAt(index);
    }
    public int getCurrentStatus(){
        return statsComboBox.getSelectedIndex();
    }
    public void changeStatusEnabled(boolean enable){
        statsComboBox.setEnabled(enable);
    }
////////////////////////clasees to add close button to the tab...
    public void updateUserStatus(int status){
        statsComboBox.setSelectedIndex(status);
    }
    public int getInitial_status() {
        return initial_status;
    }

    public void setInitial_status(int initial_status) {
        this.initial_status = initial_status;
    }

    public javax.swing.JTabbedPane getParentTabbedPane() {
        return parentTabbedPane;
    }

    public void setParentTabbedPane(javax.swing.JTabbedPane parentTabbedPane) {
        this.parentTabbedPane = parentTabbedPane;
    }
}
