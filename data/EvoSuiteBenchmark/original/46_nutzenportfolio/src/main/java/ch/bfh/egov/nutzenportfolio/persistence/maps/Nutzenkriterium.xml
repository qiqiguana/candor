<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="Nutzenkriterium">

  <typeAlias alias="NutzenkriteriumObject" type="ch.bfh.egov.nutzenportfolio.tos.Nutzenkriterium"/>
  <typeAlias alias="NaOpNuObject" type="ch.bfh.egov.nutzenportfolio.tos.NaOpNu"/>
  <typeAlias alias="CustomizingObject" type="ch.bfh.egov.nutzenportfolio.tos.Customizing"/>

  <resultMap id="nutzenkriteriumResult" class="NutzenkriteriumObject">
	  <result property="nutzenkriteriumId"							column="nutzenkriteriumId"/>
	  <result property="kategorieId"										column="kategorieId"/>
	  <result property="mandantId"											column="mandantId"/>	  
	  <result property="name"														column="name"/>
	  <result property="beschreibung"										column="beschreibung"/>
	  <result property="frageManagementDefault"					column="frageManagementDefault"/>
	  <result property="frageProjektbetroffeneDefault"	column="frageProjektbetroffeneDefault"/>
	  <result property="kategorieName"									column="kategorieName"/>
  </resultMap>
  
  <resultMap id="nutzenkriteriumAssignmentResult" class="NutzenkriteriumObject">
	  <result property="nutzenkriteriumId"											column="nutzenkriteriumId"/>
	  <result property="kategorieId"														column="kategorieId"/>
	  <result property="nutzenattraktivitaetOperativerNutzenId"	column="nutzenattraktivitaetOperativerNutzenId"/>
	  <result property="name"																		column="name"/>
	  <result property="beschreibung"														column="beschreibung"/>
	  <result property="frageManagement"												column="frageManagement"/>
	  <result property="frageProjektbetroffene"									column="frageProjektbetroffene"/>
	  <result property="frageManagementDefault"									column="frageManagementDefault"/>
	  <result property="frageProjektbetroffeneDefault"					column="frageProjektbetroffeneDefault"/>
	  <result property="mandantId"															column="mandantId"/>	  
	  <result property="gewichtung"															column="gewichtung"/>
	  <result property="kategorieGewichtung"										column="kategorieGewichtung"/>
  </resultMap>
  
  <resultMap id="frageResult" class="NutzenkriteriumObject">
	  <result property="nutzenkriteriumId"											column="nutzenkriteriumId"/>
	  <result property="nutzenattraktivitaetOperativerNutzenId"	column="nutzenattraktivitaetOperativerNutzenId"/>
	  <result property="kategorieId"														column="kategorieId"/>
	  <result property="name"																		column="name"/>
	  <result property="kategorieName"													column="kategorieName"/>
	  <result property="frageProjektbetroffene"									column="frageProjektbetroffene"/>
	  <result property="frageManagement"												column="frageManagement"/>
	  <result property="mandantId"															column="mandantId"/>	  
	  <result property="gewichtung"															column="gewichtung"/>
	  <result property="kategorieGewichtung"										column="kategorieGewichtung"/>
  </resultMap>
  
  <resultMap id="defaultFragenResult" class="NutzenkriteriumObject">
	  <result property="frageManagementDefault"									column="frageManagementDefault"/>
	  <result property="frageProjektbetroffeneDefault"					column="frageProjektbetroffeneDefault"/>
  </resultMap>
  
  <resultMap id="customizingResult" class="CustomizingObject">
    <result property="customizingId"			column="customizingId"/>
    <result property="name"								column="name"/>
    <result property="status"							column="status"/>
  </resultMap>
  
  <select
  		id="getAll"
  		parameterClass="java.lang.Integer"
  		resultMap="nutzenkriteriumResult">
    SELECT
    	nutzenkriteriumId, n.kategorieId, n.mandantId, n.name, n.beschreibung, 
    	frageManagementDefault, frageProjektbetroffeneDefault, k.name AS kategorieName
    FROM
     	Nutzenkriterium AS n,
    	Kategorie AS k
    WHERE
    	n.kategorieId = k.kategorieId
    	AND n.mandantId = #value#
  </select>

  <select
  		id="getById"
  		parameterClass="NutzenkriteriumObject"
  		resultMap="nutzenkriteriumResult">
    SELECT
    	nutzenkriteriumId, n.kategorieId, n.mandantId, n.name, n.beschreibung, 
    	frageManagementDefault, frageProjektbetroffeneDefault, k.name AS kategorieName
    FROM
    	Nutzenkriterium AS n,
    	Kategorie AS k
    WHERE
			n.kategorieId = k.kategorieId
    	AND n.mandantId = #mandantId#
    	AND nutzenkriteriumId = #nutzenkriteriumId#
  </select>
  
  <select
  		id="getByName"
  		resultMap="nutzenkriteriumResult"
  		parameterClass="NutzenkriteriumObject">
    SELECT
    	nutzenkriteriumId, n.kategorieId, n.mandantId, n.name, n.beschreibung, 
    	frageManagementDefault, frageProjektbetroffeneDefault, k.name AS kategorieName
    FROM
     	Nutzenkriterium AS n,
    	Kategorie AS k
    WHERE
    	n.kategorieId = k.kategorieId
    	AND n.name LIKE #name#
    	AND n.mandantId = #mandantId#
  </select>
  
  <select
  		id="getByProjektId"
  		parameterClass="NaOpNuObject"
  		resultMap="frageResult">
    SELECT
    	n.nutzenkriteriumId, n.name, k.kategorieId, k.name AS kategorieName,
    	nn.nutzenattraktivitaetOperativerNutzenId, nn.frageManagement,
    	nn.frageProjektbetroffene, n.mandantId, nn.gewichtung,
    	kn.gewichtung AS kategorieGewichtung
    FROM
	    Nutzenkriterium AS n,
			Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen AS nn,
			NutzenattraktivitaetOperativerNutzen AS non,
	    Kategorie AS k,
			Kategorie_has_NutzenattraktivitaetOperativerNutzen AS kn,
	    Customizing AS c,
    	Projektgruppe AS pg,
    	Projekt AS p
    WHERE
    	non.nutzenattraktivitaetOperativerNutzenId = nn.nutzenattraktivitaetOperativerNutzenId AND
    	non.nutzenattraktivitaet = #nutzenattraktivitaet# AND
    	non.operativerNutzen = #operativerNutzen# AND
    	non.customizingId = c.customizingId AND
    	pg.customizingId = c.customizingId AND
    	p.projektgruppeId = pg.projektgruppeId AND
    	n.nutzenkriteriumId = nn.nutzenkriteriumId AND
    	n.kategorieId = k.kategorieId AND
    	k.kategorieId = kn.kategorieId AND 
			kn.nutzenattraktivitaetOperativerNutzenId = nn.nutzenattraktivitaetOperativerNutzenId AND
			p.projektId = #projektId#
  </select>
  
  <select
  		id="getByKategorie"
  		resultMap="nutzenkriteriumAssignmentResult"
  		parameterClass="NutzenkriteriumObject">
    SELECT
    	n.nutzenkriteriumId, n.kategorieId, nn.nutzenattraktivitaetOperativerNutzenId,
    	n.name, n.beschreibung, frageManagement, frageProjektbetroffene, n.mandantId,
    	nn.gewichtung, kn.gewichtung AS kategorieGewichtung, frageManagementDefault,
    	frageProjektbetroffeneDefault
    FROM
    	Kategorie AS k,
    	Nutzenkriterium AS n
    LEFT JOIN Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen AS nn
    ON n.nutzenkriteriumId = nn.nutzenkriteriumId
    LEFT JOIN
			Kategorie_has_NutzenattraktivitaetOperativerNutzen AS kn
		ON
			kn.kategorieId = n.kategorieId AND
			kn.nutzenattraktivitaetOperativerNutzenId = nn.nutzenattraktivitaetOperativerNutzenId
    WHERE
    	n.kategorieId = k.kategorieId AND
    	n.kategorieId = #kategorieId#
  </select>
  
  <select
  		id="getByNaOpNuAndKategorie"
  		resultMap="nutzenkriteriumAssignmentResult"
  		parameterClass="NutzenkriteriumObject">
    SELECT
    	n.nutzenkriteriumId, n.kategorieId, nn.nutzenattraktivitaetOperativerNutzenId,
    	n.name, n.beschreibung, frageManagement, frageProjektbetroffene, n.mandantId,
    	nn.gewichtung, kn.gewichtung AS kategorieGewichtung, frageManagementDefault,
    	frageProjektbetroffeneDefault
    FROM
    	Kategorie AS k,
    	Nutzenkriterium AS n
    LEFT JOIN Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen AS nn
    ON n.nutzenkriteriumId = nn.nutzenkriteriumId
    LEFT JOIN
			Kategorie_has_NutzenattraktivitaetOperativerNutzen AS kn
		ON
			kn.kategorieId = n.kategorieId AND
			kn.nutzenattraktivitaetOperativerNutzenId = nn.nutzenattraktivitaetOperativerNutzenId
    WHERE
    	n.kategorieId = k.kategorieId AND
    	nn.nutzenattraktivitaetOperativerNutzenId = #nutzenattraktivitaetOperativerNutzenId# AND
    	n.kategorieId = #kategorieId#
  </select>
  
  <select
  		id="getDefaultFragen"
  		resultMap="defaultFragenResult"
  		parameterClass="NutzenkriteriumObject">
    SELECT frageManagementDefault, frageProjektbetroffeneDefault
    FROM Nutzenkriterium
    WHERE
    	nutzenkriteriumId = #nutzenkriteriumId# AND
    	mandantId = #mandantId#
  </select>
  
  <insert id="insert" parameterClass="NutzenkriteriumObject">
    INSERT INTO Nutzenkriterium (kategorieId, name, beschreibung, mandantId)
    VALUES (#kategorieId#, #name#, #beschreibung#, #mandantId#)
    <selectKey resultClass="java.lang.Integer" keyProperty="nutzenkriteriumId">
			SELECT LAST_INSERT_ID() AS nutzenkriteriumId
		</selectKey>
  </insert>

  <update id="update" parameterClass="NutzenkriteriumObject">
    UPDATE Nutzenkriterium
    SET
      name = #name#,
      beschreibung = #beschreibung#,
      frageManagementDefault = #frageManagementDefault#,
      frageProjektbetroffeneDefault = #frageProjektbetroffeneDefault#,
      kategorieId = #kategorieId#
    WHERE nutzenkriteriumId = #nutzenkriteriumId#
  </update>
  
  <delete id="delete" parameterClass="NutzenkriteriumObject">
    DELETE FROM Nutzenkriterium
    WHERE
    	nutzenkriteriumId = #nutzenkriteriumId# AND
    	mandantId = #mandantId#
  </delete>
  
  <select
  		id="getAssignments"
  		parameterClass="NutzenkriteriumObject"
  		resultMap="frageResult">
    SELECT
    	n.nutzenkriteriumId, n.name, k.kategorieId, k.name AS kategorieName,
    	nn.nutzenattraktivitaetOperativerNutzenId, nn.frageManagement,
    	nn.frageProjektbetroffene, n.mandantId, nn.gewichtung,
    	kn.gewichtung AS kategorieGewichtung
    FROM
	    Nutzenkriterium AS n,
			Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen AS nn,
	    Kategorie AS k,
	    Kategorie_has_NutzenattraktivitaetOperativerNutzen AS kn
    WHERE n.nutzenkriteriumId = nn.nutzenkriteriumId AND
    	n.kategorieId = k.kategorieId AND
    	k.kategorieId = kn.kategorieId AND
    	kn.nutzenattraktivitaetOperativerNutzenId = nn.nutzenattraktivitaetOperativerNutzenId AND
    	nn.nutzenattraktivitaetOperativerNutzenId = #nutzenattraktivitaetOperativerNutzenId# AND
    	k.mandantId = #mandantId#
  </select>
  
  <select
  		id="getAssignmentById"
  		parameterClass="NutzenkriteriumObject"
  		resultMap="nutzenkriteriumAssignmentResult">
    SELECT
    	n.nutzenkriteriumId, n.kategorieId, nn.nutzenattraktivitaetOperativerNutzenId,
    	n.name, n.beschreibung, frageManagement, frageProjektbetroffene, n.mandantId,
    	nn.gewichtung, kn.gewichtung AS kategorieGewichtung, frageManagementDefault,
    	frageProjektbetroffeneDefault
    FROM
    	Kategorie AS k,
     	Nutzenkriterium AS n
   	LEFT JOIN
    	Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen AS nn
		ON n.nutzenkriteriumId = nn.nutzenkriteriumId
		LEFT JOIN
			Kategorie_has_NutzenattraktivitaetOperativerNutzen AS kn
		ON
			kn.kategorieId = n.kategorieId AND
			kn.nutzenattraktivitaetOperativerNutzenId = nn.nutzenattraktivitaetOperativerNutzenId
    WHERE
    	n.nutzenkriteriumId = #nutzenkriteriumId# AND
    	nn.nutzenattraktivitaetOperativerNutzenId = #nutzenattraktivitaetOperativerNutzenId# AND
    	k.mandantId = #mandantId#
		GROUP BY
			n.nutzenkriteriumId, n.kategorieId, nn.nutzenattraktivitaetOperativerNutzenId,
			n.name, n.beschreibung, frageManagement, frageProjektbetroffene, nn.gewichtung,
			kn.gewichtung, frageManagementDefault, frageProjektbetroffeneDefault
  </select>
  
  <select
  		id="getLinkedCustomizings"
  		parameterClass="NutzenkriteriumObject"
  		resultMap="customizingResult">
    SELECT c.customizingId, name, status
    FROM
    	Customizing AS c, NutzenattraktivitaetOperativerNutzen AS n,
    	Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen AS nn
    WHERE
    	c.customizingId = n.customizingId
    	AND n.nutzenattraktivitaetOperativerNutzenId = nn.nutzenattraktivitaetOperativerNutzenId
    	AND nutzenkriteriumId = #nutzenkriteriumId#
    	AND mandantId = #mandantId#
    GROUP BY c.customizingId
  </select>
  
 	<update id="updateAssignment" parameterClass="NutzenkriteriumObject">
    UPDATE Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen
    SET
    	frageManagement = #frageManagement#,
    	frageProjektbetroffene = #frageProjektbetroffene#
    WHERE
    	nutzenattraktivitaetOperativerNutzenId = #nutzenattraktivitaetOperativerNutzenId# AND
    	nutzenkriteriumId = #nutzenkriteriumId#
  </update>
  
 	<update id="updateAssignmentGewichtung" parameterClass="NutzenkriteriumObject">
    UPDATE Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen
    SET gewichtung = #gewichtung#
    WHERE
    	nutzenattraktivitaetOperativerNutzenId = #nutzenattraktivitaetOperativerNutzenId# AND
    	nutzenkriteriumId = #nutzenkriteriumId#
  </update>
  
 	<update id="unsetAssignmentGewichtung" parameterClass="java.lang.Integer">
    UPDATE Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen
    SET gewichtung = null
    WHERE nutzenattraktivitaetOperativerNutzenId = #value#
  </update>
  
  <insert id="insertAssignment" parameterClass="NutzenkriteriumObject">
    INSERT INTO Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen
    	(nutzenattraktivitaetOperativerNutzenId, nutzenkriteriumId,
    	frageManagement, frageProjektbetroffene, gewichtung)
    VALUES
    	(#nutzenattraktivitaetOperativerNutzenId#, #nutzenkriteriumId#,
    	#frageManagement#, #frageProjektbetroffene#, #gewichtung#)
  </insert>
  
  <delete id="deleteAssignment" parameterClass="NutzenkriteriumObject">
    DELETE
    FROM Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen
    WHERE
    	nutzenattraktivitaetOperativerNutzenId = #nutzenattraktivitaetOperativerNutzenId# AND
    	nutzenkriteriumId = #nutzenkriteriumId#
  </delete>
  
  <delete id="deleteAssignments" parameterClass="java.lang.Integer">
    DELETE
    FROM Nutzenkriterium_has_NutzenattraktivitaetOperativerNutzen
    WHERE
    	nutzenattraktivitaetOperativerNutzenId = #nutzenattraktivitaetOperativerNutzenId#
  </delete>

</sqlMap>